#!/usr/bin/env perl

use strict;
use warnings;
use 5.014;

use File::Slurp qw(write_file);
use Time::HiRes qw(usleep);

our $VERSION = '0.01';

sub sda {
	my ($value) = @_;
	write_file( '/sys/class/gpio/gpio22/value', $value );
	usleep(3);
}

sub scl {
	my ($value) = @_;
	write_file( '/sys/class/gpio/gpio23/value', $value );
	usleep(3);
}

while ( my $line = <STDIN> ) {
	if ( length($line) ) {
		sda(0);
		scl(0);
		sda($line);
		scl(1);
	}
}

sda(1);
scl(0);

__END__

=head1 NAME

=head1 SYNOPSIS

=head1 VERSION

=head1 DESCRIPTION

Reads serial bits from stdin, separated by newlines. Least Significan Bit
first.

=head1 OPTIONS

=over

=back

=head1 EXIT STATUS

=head1 CONFIGURATION

None.

=head1 DEPENDENCIES

=over

=back

=head1 BUGS AND LIMITATIONS

=head1 AUTHOR

Copyright (C) 2013 by Daniel Friesel E<lt>derf@finalrewind.orgE<gt>

=head1 LICENSE

  0. You just DO WHAT THE FUCK YOU WANT TO.
